<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>CIVITAS</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2a2418">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
/* =========================
   GLOBAL — STYLE PARCHEMIN
========================= */
:root{
  --paper:#efe7d3;
  --ink:#2b2418;
  --muted:#6f6652;
  --accent:#8a6a3f;
  --danger:#7a2e2e;
  --good:#4f6b4f;
}

*{box-sizing:border-box}
html,body{height:100%;margin:0}
body{
  font-family: "Georgia", serif;
  background:
    radial-gradient(1200px 800px at 30% 20%, #f6f0e3, transparent 60%),
    linear-gradient(#e9dfc6,#d8ccb0);
  color:var(--ink);
  overflow:hidden;
}

/* =========================
   SCREENS
========================= */
.screen{
  position:absolute;
  inset:0;
  display:none;
  padding:16px;
}
.screen.active{display:block}

/* =========================
   ACCUEIL
========================= */
#home{
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  gap:24px;
}

#title{
  font-size:42px;
  letter-spacing:4px;
}

.menuBtn{
  padding:14px 26px;
  font-size:18px;
  background:var(--paper);
  border:2px solid var(--ink);
  cursor:pointer;
}

/* =========================
   WIZARD
========================= */
#wizard{
  max-width:640px;
  margin:auto;
}

.step{
  margin-bottom:20px;
}

.step h2{
  margin:0 0 8px;
}

select,input{
  width:100%;
  padding:10px;
  font-size:16px;
}

/* =========================
   GAME UI
========================= */
#game{
  display:grid;
  grid-template-columns: 1fr 320px;
  grid-template-rows: auto 1fr auto;
  gap:8px;
  height:100%;
}

#hud{
  grid-column:1/3;
  padding:8px;
  border-bottom:2px solid var(--ink);
}

#map{
  background:#ddd3b8;
  border:2px solid var(--ink);
  position:relative;
}

#side{
  border-left:2px solid var(--ink);
  padding:8px;
  overflow:auto;
}

#actions{
  grid-column:1/3;
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:8px;
  padding:8px;
  border-top:2px solid var(--ink);
}

.action{
  border:1px solid var(--ink);
  background:var(--paper);
  padding:6px;
  font-size:14px;
  cursor:pointer;
}

/* =========================
   HEX MAP
========================= */
canvas{
  width:100%;
  height:100%;
  display:block;
}
</style>
</head>

<body>

<!-- =========================
     HOME
========================= -->
<div id="home" class="screen active">
  <div id="title">CIVITAS</div>
  <button class="menuBtn" onclick="startWizard()">Créer civilisation</button>
  <button class="menuBtn" onclick="loadArchive()">Archives</button>
</div>

<!-- =========================
     WIZARD
========================= -->
<div id="wizard" class="screen">
  <div class="step">
    <h2>A — Époque</h2>
    <select id="epoch">
      <option value="prehistoire">Préhistoire</option>
      <option value="antiquite">Antiquité</option>
      <option value="medieval">Médiéval</option>
      <option value="industriel">Industriel</option>
    </select>
  </div>

  <div class="step">
    <h2>B — Monde</h2>
    <select id="world">
      <option value="continent">Terre alternative</option>
      <option value="archipel">Archipel</option>
      <option value="supercontinent">Supercontinent</option>
    </select>
  </div>

  <div class="step">
    <h2>C — Civilisation</h2>
    <input id="civName" placeholder="Nom de votre civilisation">
  </div>

  <div class="step">
    <h2>D — Difficulté</h2>
    <div>IMPITOYABLE (modèle CivilWar)</div>
  </div>

  <button class="menuBtn" onclick="startGame()">Fonder</button>
</div>

<!-- =========================
     GAME
========================= -->
<div id="game" class="screen">
  <div id="hud"></div>
  <div id="map"><canvas id="mapCanvas"></canvas></div>
  <div id="side"></div>
  <div id="actions"></div>
</div>

<script>
/* =========================
   GAME STATE
========================= */
let game=null;

/* =========================
   NAVIGATION
========================= */
function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function startWizard(){
  show('wizard');
}

function loadArchive(){
  alert("Archives — à venir");
}

/* =========================
   START GAME
========================= */
function startGame(){
  game={
    seed:Math.floor(Math.random()*999999),
    turn:1,
    epoch:epoch.value,
    world:world.value,
    player:{
      name:civName.value||"Civilisation sans nom",
      population:120,
      food:90,
      materials:70,
      influence:50,
      cohesion:60
    },
    factions:generateFactions(),
    map:generateMap(48,28),
    log:[]
  };
  saveGame();
  initGameUI();
  show('game');
}

/* =========================
   MAP GENERATION
========================= */
function generateMap(w,h){
  let hexes=[];
  for(let r=0;r<h;r++){
    for(let q=0;q<w;q++){
      hexes.push({
        q,r,
        biome:["plaine","foret","montagne","eau"][Math.floor(Math.random()*4)],
        seen:false
      });
    }
  }
  return {w,h,hexes};
}

/* =========================
   FACTIONS
========================= */
function generateFactions(){
  const names=["Khar","Ulren","Sava","Tyr","Oshen","Varak","Nemor"];
  let list=[];
  for(let i=0;i<6;i++){
    list.push({
      id:i,
      name:names[Math.floor(Math.random()*names.length)]+"a",
      power:Math.floor(Math.random()*50)+30,
      relation:"unknown"
    });
  }
  return list;
}

/* =========================
   UI INIT
========================= */
function initGameUI(){
  document.getElementById('hud').innerText=
    `${game.player.name} — Tour ${game.turn} — ${game.epoch}`;

  drawMap();
  renderActions();
}

/* =========================
   DRAW MAP
========================= */
function drawMap(){
  const canvas=document.getElementById('mapCanvas');
  const ctx=canvas.getContext('2d');
  canvas.width=canvas.clientWidth;
  canvas.height=canvas.clientHeight;

  const size=12;
  game.map.hexes.forEach(h=>{
    const x = h.q*size*1.5+20;
    const y = h.r*size*Math.sqrt(3)+(h.q%2?size*Math.sqrt(3)/2:0)+20;
    ctx.beginPath();
    for(let i=0;i<6;i++){
      const a=Math.PI/3*i;
      ctx.lineTo(x+size*Math.cos(a),y+size*Math.sin(a));
    }
    ctx.closePath();
    ctx.strokeStyle="#2b2418";
    ctx.stroke();
  });
}

/* =========================
   ACTIONS
========================= */
function renderActions(){
  const box=document.getElementById('actions');
  box.innerHTML="";
  const actions=[
    {t:"Rassembler le conseil",r:"faible"},
    {t:"Consolider les réserves",r:"moyen"},
    {t:"Envoyer des éclaireurs",r:"élevé"},
    {t:"Renforcer la garde",r:"moyen"}
  ];
  actions.forEach(a=>{
    const d=document.createElement('div');
    d.className="action";
    d.innerHTML=`<b>${a.t}</b><br>Risque ${a.r}`;
    box.appendChild(d);
  });
}

/* =========================
   SAVE
========================= */
function saveGame(){
  localStorage.setItem("civitas_save",JSON.stringify(game));
}
</script>

</body>
</html>
